// Generated by CoffeeScript 1.4.0
(function(){var e,t,n,r,i,s,o,u,a;try{n=require("nw.gui");t=require("fs");o=require("path");i=require("ncp").ncp;a=require("util");e="Unknown OS";navigator.appVersion.indexOf("Win")!==-1&&(e="Windows");navigator.appVersion.indexOf("Mac")!==-1&&(e="Mac");navigator.appVersion.indexOf("X11")!==-1&&(e="UNIX");navigator.appVersion.indexOf("Linux")!==-1&&(e="Linux");s=!0;r=process.env.HOME;e==="Mac"&&(u=o.join(r,"/Library/Application Support/Noted/"));e==="Windows"&&(u=o.join(process.env.LOCALAPPDATA,"/Noted"));e==="Linux"&&(u=o.join(r,"/.config/Noted/"))}catch(f){}window.noted={selectedList:"all",selectedNote:"",setupPanel:function(){var e;e=n.Window.get();e.show();e.showDevTools();$("#close").click(function(){return e.close()});$("#minimize").click(function(){return e.minimize()});$("#maximize").click(function(){return e.maximize()});$("#panel").mouseenter(function(){return $("#panel").addClass("drag")}).mouseleave(function(){return $("#panel").removeClass("drag")});return $("#panel #decor img, #panel #noteControls img, #panel #search").mouseenter(function(){return $("#panel").removeClass("drag")}).mouseleave(function(){return $("#panel").addClass("drag")})},setupUI:function(){$("#content header .edit").click(function(){if($(this).text()==="save"){$(this).text("edit");$(".headerwrap .left h1").attr("contenteditable","false");window.noted.editor.save();return window.noted.editor.preview()}$(this).text("save");$(".headerwrap .left h1").attr("contenteditable","true");return window.noted.editor.edit()});$("body").on("click","#notebooks li",function(){$(this).parent().find(".selected").removeClass("selected");$(this).addClass("selected");window.noted.loadNotes($(this).text());return window.noted.deselectNote()});$("body").on("keydown","#notebooks input",function(e){if(e.keyCode===13){e.preventDefault();t.mkdir(o.join(u,"Notebooks",$("#notebooks input").val()));window.noted.listNotebooks();$("#notebooks input").val("");return setTimeout(function(){return $("#notebooks input").blur()},50)}});$("body").on("click","#notes li",function(){$("#notes .selected").removeClass("selected");$(this).addClass("selected");return window.noted.loadNote($(this))});$("body").on("keydown",".headerwrap .left h1",function(e){if(e.keyCode===13){e.preventDefault();return $(this).blur()}});$("body").on("keyup",".headerwrap .left h1",function(e){if($(this).text()!==""){$("#notes [data-id='"+window.noted.selectedNote+"']").attr("data-id",$(this).text()).find("h2").text($(this).text());t.rename(o.join(u,"Notebooks",window.noted.selectedList,window.noted.selectedNote+".txt"),o.join(u,"Notebooks",window.noted.selectedList,$(this).text()+".txt"));return window.noted.selectedNote=$(this).text()}});window.noted.editor=new EpicEditor({container:"contentbody",file:{name:"epiceditor",defaultContent:"",autoSave:2500},theme:{base:"/themes/base/epiceditor.css",preview:"/themes/preview/style.css",editor:"/themes/editor/style.css"}});window.noted.editor.load();window.noted.editor.on("save",function(e){var n;n=$("#notes li[data-id='"+window.noted.selectedNote+"']").attr("data-list");if(window.noted.selectedNote!==""){t.writeFile(o.join(u,"Notebooks",n,window.noted.selectedNote+".txt"),e.content);return window.noted.loadNotes(window.noted.selectedList)}});$("#new").click(function(){var e;if(window.noted.selectedList!=="All Notes"){$("#notes ul").append("<li data-id='Untitled Note' data-list='"+window.noted.selectedList+"'><h2>Untitled Note</h2><time></time></li>");e="Add some content!";return t.writeFile(o.join(u,"Notebooks",window.noted.selectedList,"Untitled Note.txt"),e)}});return $("#del").click(function(){window.noted.editor.remove("file");return t.unlink(o.join(u,"Notebooks",$("#notes li[data-id='"+window.noted.selectedNote+"']").attr("data-list"),window.noted.selectedNote+".txt"),function(e){if(e)throw e;window.noted.deselectNote();return window.noted.loadNotes(window.noted.selectedList)})})},render:function(){return window.noted.listNotebooks()},listNotebooks:function(){$("#notebooks ul").html("").append("<li class='all'>All Notes</li>");return t.readdir(o.join(u,"Notebooks"),function(e,n){var r;r=0;while(r<n.length){t.statSync(o.join(u,"Notebooks",n[r])).isDirectory()&&$("#notebooks ul").append("<li data-id='"+n[r]+"'>"+n[r]+"</li>");r++}return window.noted.selectedList==="all"?$("#notebooks .all").trigger("click"):$("#notebooks [data-id='"+window.noted.selectedList+"']").addClass("selected").trigger("click")})},loadNotes:function(e,n){if(e==="All Notes"){window.noted.selectedList=e;$("#notes ul").html("");return t.readdir(o.join(u,"Notebooks"),function(e,n){var r,i;r=0;i=[];while(r<n.length){t.statSync(o.join(u,"Notebooks",n[r])).isDirectory()&&window.noted.loadNotes(n[r],"all");i.push(r++)}return i})}if(n!=="all"){window.noted.selectedList=e;$("#notes header h1").html(e);$("#notes ul").html("")}else $("#notes header h1").html("All Notes");return t.readdir(o.join(u,"Notebooks",e),function(n,r){var i,s,a,f,l;i=0;l=[];while(i<r.length){if(r[i].substr(r[i].length-4,r[i].length)===".txt"){s=r[i].substr(0,r[i].length-4);a=t.statSync(o.join(u,"Notebooks",e,s+".txt")).ctime;f=new Date(Date.parse(a));$("#notes ul").append("<li data-id='"+s+"' data-list='"+e+"'><h2>"+s+"</h2><time>"+f.getDate()+"/"+(f.getMonth()+1)+"/"+f.getFullYear()+"</time></li>")}l.push(i++)}return l})},loadNote:function(e){window.noted.selectedNote=$(e).find("h2").text();return t.readFile(o.join(u,"Notebooks",$(e).attr("data-list"),window.noted.selectedNote+".txt"),"utf-8",function(n,r){var i,s;if(n)throw n;$("#content").removeClass("deselected");$(".headerwrap .left h1").text(window.noted.selectedNote);i=t.statSync(o.join(u,"Notebooks",$(e).attr("data-list"),window.noted.selectedNote+".txt")).ctime;s=new Date(Date.parse(i));$(".headerwrap .left time").text(window.noted.timeControls.pad(s.getDate())+"/"+window.noted.timeControls.pad(s.getMonth()+1)+"/"+s.getFullYear()+" "+window.noted.timeControls.pad(s.getHours())+":"+window.noted.timeControls.pad(s.getMinutes()));window.noted.editor.importFile("file",r);return window.noted.editor.preview()})},deselectNote:function(){$("#content").addClass("deselected");$("#content .left h1, #content .left time").text("");window.noted.selectedNote="";window.noted.editor.importFile("file","");return window.noted.editor.preview()}};window.noted.timeControls={pad:function(e){return e<10?"0"+e:e}};$(function(){window.noted.setupUI();if(s){window.noted.setupPanel();return t.readdir(o.join(u,"/Notebooks/"),function(e,n){if(!e)return window.noted.render();if(e.code==="ENOENT")return t.mkdir(o.join(u,"/Notebooks/"),function(){return i(o.join(window.location.pathname,"../default_notebooks"),o.join(u,"/Notebooks/"),function(e){return window.noted.render()})})})}})}).call(this);